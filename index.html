<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hyper Dash 4</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="header">
    <img src="images/logo.png" alt="Hyper Dash 4" id="logo">
    <h1>Hyper Dash 4</h1>
  </div>

  <div id="shop">
    <h2>Shop</h2>
    <p>Coins: <span id="coins">0</span></p>
    <div id="troops"></div>
    <div id="items"></div>
  </div>

  <div id="lobby">
    <h2>Lobbies</h2>
    <button onclick="createLobby()">Create Lobby</button>
    <button onclick="listLobbies()">Refresh Lobbies</button>
    <div id="lobbies"></div>
  </div>

  <div id="game">
    <h2>Game</h2>
    <p id="turn"></p>
    <button onclick="endTurn()">End Turn</button>
    <div id="log"></div>
  </div>

  <script>
  const ws = new WebSocket("wss://YOUR-REPL-URL-HERE"); // replace with your Replit URL

  let coins = 20;
  let loadout = { troops: [], items: [] };

  const TROOPS = [
    { id: "soldier", name: "Soldier", cost: 5 },
    { id: "tank", name: "Tank", cost: 15 },
    { id: "archer", name: "Archer", cost: 7 },
  ];

  const ITEMS = [
    { id: "potion", name: "Potion", cost: 5 },
    { id: "bomb", name: "Bomb", cost: 8 },
  ];

  function addLog(msg) {
    document.getElementById("log").innerHTML += `<div>${msg}</div>`;
  }

  function updateCoins() {
    document.getElementById("coins").textContent = coins;
  }

  function renderShop() {
    const troopDiv = document.getElementById("troops");
    troopDiv.innerHTML = "<h3>Troops</h3>";
    TROOPS.forEach(t => {
      troopDiv.innerHTML += `<button onclick="buyTroop('${t.id}')">${t.name} (${t.cost})</button>`;
    });

    const itemDiv = document.getElementById("items");
    itemDiv.innerHTML = "<h3>Items</h3>";
    ITEMS.forEach(i => {
      itemDiv.innerHTML += `<button onclick="buyItem('${i.id}')">${i.name} (${i.cost})</button>`;
    });
  }

  function buyTroop(id) {
    const t = TROOPS.find(x => x.id === id);
    if (coins >= t.cost) {
      coins -= t.cost;
      loadout.troops.push(t.id);
      updateCoins();
      addLog("Bought " + t.name);
      ws.send(JSON.stringify({ type: "purchase_request", itemType: "troop", itemId: t.id }));
    } else addLog("Not enough coins!");
  }

  function buyItem(id) {
    const it = ITEMS.find(x => x.id === id);
    if (coins >= it.cost) {
      coins -= it.cost;
      loadout.items.push(it.id);
      updateCoins();
      addLog("Bought " + it.name);
      ws.send(JSON.stringify({ type: "purchase_request", itemType: "item", itemId: it.id }));
    } else addLog("Not enough coins!");
  }

  function createLobby() {
    ws.send(JSON.stringify({ type: "create_lobby" }));
  }

  function listLobbies() {
    ws.send(JSON.stringify({ type: "list_lobbies" }));
  }

  function joinLobby(id) {
    ws.send(JSON.stringify({ type: "join_lobby", lobbyId: id }));
  }

  function endTurn() {
    ws.send(JSON.stringify({ type: "end_turn" }));
  }

  ws.onmessage = (ev) => {
    const msg = JSON.parse(ev.data);
    if (msg.type === "welcome") {
      coins = msg.coins;
      updateCoins();
      renderShop();
      addLog("Connected as " + msg.playerId);
    } else if (msg.type === "lobby_created" || msg.type === "lobby_joined") {
      addLog("In lobby " + msg.lobbyId);
      ws.send(JSON.stringify({
        type: "setLoadout",
        lobbyId: msg.lobbyId,
        troops: loadout.troops,
        items: loadout.items
      }));
    } else if (msg.type === "lobby_update") {
      document.getElementById("lobbies").innerHTML =
        `Players: ${msg.players.join(", ")}`;
    } else if (msg.type === "list_lobbies") {
      document.getElementById("lobbies").innerHTML =
        msg.lobbies.map(l => `<button onclick="joinLobby('${l.id}')">Join Lobby ${l.id} (${l.players} players)</button>`).join("<br>");
    } else if (msg.type === "state") {
      document.getElementById("turn").textContent = "Turn: " + msg.turn;
    } else if (msg.type === "purchase_success") {
      coins = msg.coins;
      updateCoins();
    }
  };
  </script>
</body>
</html>

</body>
</html>
