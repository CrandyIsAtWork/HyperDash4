<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hyper Dash 4</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #logo {
      width: 200px;
      margin: 20px auto;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    #shop, #lobby {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <img id="logo" src="images/logo.png" alt="Hyper Dash 4">
  <h1>Hyper Dash 4</h1>

  <div id="menu">
    <input type="text" id="name" placeholder="Enter your name"><br>
    <button id="create">Create Lobby</button>
    <input type="text" id="joinId" placeholder="Lobby ID">
    <button id="join">Join Lobby</button>
  </div>

  <div id="shop">
    <h2>Shop (Coins: <span id="coins">0</span>)</h2>
    <button onclick="buyTroop('soldier')">Buy Soldier (5)</button>
    <button onclick="buyTroop('archer')">Buy Archer (7)</button>
    <button onclick="buyItem('potion')">Buy Potion (3)</button>
    <div id="loadout"></div>
    <button onclick="confirmLoadout()">Confirm Loadout</button>
  </div>

  <div id="lobby">
    <h2>Lobby</h2>
    <p>ID: <span id="lobbyId"></span></p>
    <div id="players"></div>
  </div>

<script>
let ws = new WebSocket("ws://localhost:3000"); // ðŸ”— change to your Replit ws:// URL
let myPlayerId = null;
let loadout = { troops: [], items: [] };

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);

  if (data.type === "welcome") {
    myPlayerId = data.playerId;
    document.getElementById("coins").textContent = data.coins;
  }

  if (data.type === "lobby_created" || data.type === "lobby_joined") {
    document.getElementById("menu").style.display = "none";
    document.getElementById("shop").style.display = "block";
    document.getElementById("lobbyId").textContent = data.lobbyId;
  }

  if (data.type === "lobby_update") {
    document.getElementById("players").innerHTML =
      "Players: " + data.players.join(", ");
  }

  if (data.type === "error") {
    alert("Error: " + data.msg);
  }
};

document.getElementById("create").onclick = () => {
  ws.send(JSON.stringify({
    type: "create_lobby",
    name: document.getElementById("name").value,
    playerId: myPlayerId
  }));
};

document.getElementById("join").onclick = () => {
  ws.send(JSON.stringify({
    type: "join_lobby",
    lobbyId: document.getElementById("joinId").value,
    playerId: myPlayerId
  }));
};

function buyTroop(t) {
  loadout.troops.push(t);
  renderLoadout();
}

function buyItem(i) {
  loadout.items.push(i);
  renderLoadout();
}

function renderLoadout() {
  document.getElementById("loadout").innerHTML =
    "Troops: " + loadout.troops.join(", ") + "<br>Items: " + loadout.items.join(", ");
}

function confirmLoadout() {
  ws.send(JSON.stringify({
    type: "setLoadout",
    playerId: myPlayerId,
    troops: loadout.troops,
    items: loadout.items
  }));
  document.getElementById("shop").style.display = "none";
  document.getElementById("lobby").style.display = "block";
}
</script>
</body>
</html>
